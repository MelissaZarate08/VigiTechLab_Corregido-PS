import{C as $}from"./auto-iNj9SIZ4.js";import{T as c,i as O}from"./wsService-CZqLgdW-.js";import{n as p}from"./index-DG_JPB1t.js";const T="http://54.211.156.108:8081",U=8,_=5e3;function R(){document.getElementById("btn-menu").onclick=()=>document.getElementById("sidebar").classList.add("visible"),document.getElementById("btn-close").onclick=()=>document.getElementById("sidebar").classList.remove("visible"),document.getElementById("btn-user").onclick=()=>document.getElementById("dropdown-user").classList.toggle("hidden"),document.getElementById("logout").onclick=()=>{localStorage.clear(),p("#/")};try{const t=JSON.parse(localStorage.getItem("currentUser"))||{};document.getElementById("user-name").textContent=t.name||"Usuario"}catch{}document.querySelectorAll(".menu a").forEach(t=>t.classList.remove("active")),document.querySelector('.menu a[href="#/camMotion"]').classList.add("active"),document.getElementById("toggle-sensors").onclick=t=>t.target.parentElement.classList.toggle("open"),document.getElementById("btn-gallery").onclick=()=>p("#/galeria");let b=null;function E(){b=O(M)}function k(){b?.close()}const i=document.getElementById("system-toggle"),v=document.getElementById("system-label");let l=localStorage.getItem("vigitech-system")||"on";i.checked=l==="on",v.textContent=`Sistema: ${l.toUpperCase()}`,i.onchange=async()=>{const t=i.checked?"on":"off";await fetch(`${T}/command/system`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:t})}),localStorage.setItem("vigitech-system",t),v.textContent=`Sistema: ${t.toUpperCase()}`;const e=document.getElementById("cam-motion-toggle"),o=document.getElementById("cam-motion-label");e.disabled=t==="off",o.style.opacity=t==="off"?.5:1,t==="off"?k():E(),c({text:`Sistema ${t==="on"?"encendido":"apagado"}`,duration:3e3,gravity:"top",position:"right",style:{background:t==="on"?"#4caf50":"#e63946"}}).showToast()};const s=document.getElementById("cam-motion-toggle"),d=document.getElementById("cam-motion-label");let I=localStorage.getItem("vigitech-camMotion")||"on";s.checked=I==="on",d.textContent=`Cámara/Movimiento: ${I.toUpperCase()}`,l==="off"&&(s.disabled=!0,d.style.opacity=.5),s.onchange=async()=>{const t=s.checked?"on":"off";await fetch(`${T}/command/sensor`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sensor:"camera",action:t})}),localStorage.setItem("vigitech-camMotion",t),d.textContent=`Cámara/Movimiento: ${t.toUpperCase()}`,c({text:`Sensor cámara/mov ${t==="on"?"activado":"desactivado"}`,duration:3e3,gravity:"top",position:"right",style:{background:t==="on"?"#4caf50":"#e63946"}}).showToast()};let m=!1,S=0;const a=document.getElementById("alert-sound");let r=!1;document.addEventListener("click",()=>{r||a.play().then(()=>{a.pause(),a.currentTime=0,r=!0}).catch(()=>{})},{once:!0});const g=document.getElementById("camMotionChart"),u=document.getElementById("camMotionTable"),y=document.getElementById("btn-chart"),h=document.getElementById("btn-table"),x=g.getContext("2d");let f=null,n=[];function B(){const t=n.map(o=>o.timestamp.slice(11,16)),e=n.map(o=>o.intensity);f&&f.destroy(),f=new $(x,{type:"line",data:{labels:t,datasets:[{label:"Intensidad",data:e,tension:.3,fill:!1}]}})}function C(){const t=u.querySelector("tbody");t.innerHTML="",n.forEach(e=>t.insertAdjacentHTML("beforeend",`
        <tr>
          <td>${e.timestamp.slice(11,16)}</td>
          <td>${e.motion_detected?"Sí":"No"}</td>
          <td>${e.intensity.toFixed(2)}</td>
        </tr>`))}y.onclick=()=>{g.classList.remove("hidden"),u.classList.add("hidden"),B(),y.classList.add("active"),h.classList.remove("active")},h.onclick=()=>{u.classList.remove("hidden"),g.classList.add("hidden"),C(),h.classList.add("active"),y.classList.remove("active")};function M(t){if(localStorage.getItem("vigitech-system")!=="on")return;if(localStorage.getItem("vigitech-camMotion")!=="on"){const L=Date.now();L-S>_&&(c({text:"Sensor cámara/mov apagado",duration:3e3}).showToast(),S=L);return}if(!t.id?.startsWith("motion"))return;n.push(t),n.length>U&&n.shift();const e=document.getElementById("rt-hour"),o=document.getElementById("rt-value");e&&o&&(e.textContent=t.timestamp.slice(11,16),o.textContent=t.motion_detected?"Detectado":"–"),B(),C(),t.motion_detected&&!m&&(m=!0,r&&(a.currentTime=0,a.play().catch(()=>{})),c({text:"Movimiento detectado",duration:5e3,gravity:"top",position:"right",style:{background:"#e63946"}}).showToast()),t.motion_detected||(m=!1)}E();const w=document.getElementById("modal-sos");document.getElementById("btn-sos").onclick=()=>w.classList.toggle("hidden"),document.getElementById("btn-stats").onclick=()=>p("#/camMotionProbability"),history.pushState(null,null,location.href),window.addEventListener("popstate",()=>history.pushState(null,null,location.href))}export{R as initCamMotionSensors};
