import{C as P}from"./auto-iNj9SIZ4.js";import{T as l,i as A}from"./wsService-CZqLgdW-.js";import{n as C}from"./index-DG_JPB1t.js";const T="http://54.211.156.108:8081",F=8,G=5e3;function D(){document.getElementById("btn-menu").onclick=()=>document.getElementById("sidebar").classList.add("visible"),document.getElementById("btn-close").onclick=()=>document.getElementById("sidebar").classList.remove("visible"),document.getElementById("btn-user").onclick=()=>document.getElementById("dropdown-user").classList.toggle("hidden"),document.getElementById("logout").onclick=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),C("#/")};try{const t=JSON.parse(localStorage.getItem("currentUser"))||{};document.getElementById("user-name").textContent=t.name||"Usuario"}catch{}document.querySelectorAll(".menu a").forEach(t=>t.classList.remove("active")),document.querySelector('.menu a[href="#/gas"]').classList.add("active"),document.getElementById("toggle-sensors").onclick=t=>t.target.parentElement.classList.toggle("open");let I=null;function E(){I=A(O)}function x(){I?.close()}const i=document.getElementById("system-toggle"),S=document.getElementById("system-label");let d=localStorage.getItem("vigitech-system")||"on";i.checked=d==="on",S.textContent=`Sistema: ${d.toUpperCase()}`,i.onchange=async()=>{const t=i.checked?"on":"off";await fetch(`${T}/command/system`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:t})}),localStorage.setItem("vigitech-system",t),S.textContent=`Sistema: ${t.toUpperCase()}`,document.getElementById("gas-toggle").disabled=t==="off",document.getElementById("gas-label").style.opacity=t==="off"?.5:1,t==="off"?x():E(),l({text:`Sistema ${t==="on"?"encendido":"apagado"}`,duration:3e3,gravity:"top",position:"right",style:{background:t==="on"?"#4caf50":"#e63946"}}).showToast()};const a=document.getElementById("gas-toggle"),m=document.getElementById("gas-label");let v=localStorage.getItem("vigitech-gas")||"on";a.checked=v==="on",m.textContent=`Gas: ${v.toUpperCase()}`,d==="off"&&(a.disabled=!0,m.style.opacity=.5),a.onchange=async()=>{const t=a.checked?"on":"off";await fetch(`${T}/command/sensor`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sensor:"gas",action:t})}),localStorage.setItem("vigitech-gas",t),m.textContent=`Gas: ${t.toUpperCase()}`,l({text:`Sensor de gas ${t==="on"?"activado":"desactivado"}`,duration:3e3,gravity:"top",position:"right",style:{background:t==="on"?"#4caf50":"#e63946"}}).showToast()};const r={LPG:1e3,CO:50,Smoke:50};let g=!1,L=0;const s=document.getElementById("alert-sound");let u=!1;document.addEventListener("click",()=>{u||s.play().then(()=>{s.pause(),s.currentTime=0,u=!0}).catch(()=>{})},{once:!0});const y=document.getElementById("gasChart"),h=document.getElementById("gasTable"),f=document.getElementById("btn-chart"),p=document.getElementById("btn-table"),w=y.getContext("2d");let b=null,o=[];function B(){const t=o.map(n=>n.timestamp.slice(11,16)),e=o.map(n=>n.lpg),c=o.map(n=>n.co),U=o.map(n=>n.smoke);b&&b.destroy(),b=new P(w,{type:"line",data:{labels:t,datasets:[{label:"LPG",data:e,tension:.3,fill:!1},{label:"CO",data:c,tension:.3,fill:!1},{label:"Humo",data:U,tension:.3,fill:!1}]}})}function k(){const t=h.querySelector("tbody");t.innerHTML="",o.forEach(e=>t.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${e.timestamp.slice(11,16)}</td>
        <td>${e.lpg.toFixed(2)}</td>
        <td>${e.co.toFixed(2)}</td>
        <td>${e.smoke.toFixed(2)}</td>
      </tr>`))}f.onclick=()=>{y.classList.remove("hidden"),h.classList.add("hidden"),B(),f.classList.add("active"),p.classList.remove("active")},p.onclick=()=>{h.classList.remove("hidden"),y.classList.add("hidden"),k(),p.classList.add("active"),f.classList.remove("active")};function O(t){if(localStorage.getItem("vigitech-system")!=="on")return;if(localStorage.getItem("vigitech-gas")!=="on"){const c=Date.now();c-L>G&&(l({text:"Sensor de gas estÃ¡ apagado",duration:3e3}).showToast(),L=c);return}if(!t.id?.startsWith("g-"))return;o.push(t),o.length>F&&o.shift(),document.getElementById("rt-lpg").textContent=t.lpg.toFixed(2),document.getElementById("rt-co").textContent=t.co.toFixed(2),document.getElementById("rt-smoke").textContent=t.smoke.toFixed(2),B(),k();const e=t.lpg>r.LPG||t.co>r.CO||t.smoke>r.Smoke;e&&!g&&(g=!0,u&&(s.currentTime=0,s.play().catch(()=>{})),l({text:"Alerta de gas alto",duration:5e3,gravity:"top",position:"right",style:{background:"#e63946"}}).showToast()),e||(g=!1)}E();const $=document.getElementById("modal-sos");document.getElementById("btn-sos").onclick=()=>{$.classList.toggle("hidden")},document.getElementById("btn-stats").onclick=()=>C("#/gasProbability"),history.pushState(null,null,location.href),window.addEventListener("popstate",()=>history.pushState(null,null,location.href))}export{D as initGasSensor};
